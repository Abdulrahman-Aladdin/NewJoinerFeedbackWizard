@page "/"
@using Volo.Abp.MultiTenancy
@using System.Linq
@inherits NewJoinerFeedbackWizardComponentBase
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
@using NewJoinerFeedbackWizard.Blazor.Client.Pages

@if (IsLoading)
{
	<div class="d-flex justify-content-center align-items-center" style="height: 100vh;">
		<div class="spinner-border text-primary" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>
	</div>
}
else
{
    <AuthorizeView>
        <Authorized>
            @if (CurrentUser != null)
            {
                <div class="container mt-4">
                    <div class="row g-4">
                        @* Employee / Lead actions *@
                        @if (CurrentUser.Roles.Contains("Employee") || CurrentUser.Roles.Contains("Lead"))
                        {
                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm hover-card" style="cursor: pointer;" @onclick='() => NavigationManager.NavigateTo("/surveys/new")'>
                                    <div class="card-body text-center p-4">
                                        <div class="mb-3" style="width:56px; height:56px; border-radius:50%; background:#2563eb; display:flex; align-items:center; justify-content:center; margin:0 auto;">
                                            <i class="fas fa-plus" style="font-size:1.25rem; color:white"></i>
                                        </div>
                                        <h4 class="mb-2">Create New Survey</h4>
                                        <p class="text-muted mb-0">Submit your feedback about onboarding</p>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm hover-card" style="cursor: pointer;" @onclick='() => NavigationManager.NavigateTo("/surveys/my-surveys")'>
                                    <div class="card-body text-center p-4">
                                        <div class="mb-3" style="width:56px; height:56px; border-radius:50%; background:#16a34a; display:flex; align-items:center; justify-content:center; margin:0 auto;">
                                            <i class="fas fa-clipboard-list" style="font-size:1.25rem; color:white"></i>
                                        </div>
                                        <h4 class="mb-2">My Surveys</h4>
                                        <p class="text-muted mb-0">View and manage your submitted feedback</p>
                                    </div>
                                </div>
                            </div>
                        }

                        @* Manager / Admin actions *@
                        @if (CurrentUser.Roles.Contains("Manager") || CurrentUser.Roles.Contains("admin"))
                        {
                            <div class="col-12">
                                <div class="card border-0 shadow-sm hover-card" style="cursor: pointer;" @onclick='() => NavigationManager.NavigateTo("/surveys/manager-dashboard")'>
                                    <div class="card-body text-center p-4">
                                        <div class="mb-3" style="width:56px; height:56px; border-radius:50%; background:#9333ea; display:flex; align-items:center; justify-content:center; margin:0 auto;">
                                            <i class="fas fa-chart-line" style="font-size:1.25rem; color:white"></i>
                                        </div>
                                        <h4 class="mb-2">Manager Dashboard</h4>
                                        <p class="text-muted mb-0">Review team surveys and satisfaction metrics</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                <div class="container mt-5 text-center">
                    <div class="alert alert-warning">Unable to load user details.</div>
                </div>
            }
        </Authorized>

        <NotAuthorized>
            <div class="container mt-5">
                <div class="card border-0 shadow-sm p-4 text-center">
                    <i class="fas fa-sign-in-alt mb-3" style="font-size:2.5rem; color:#2563eb;"></i>
                    <h3 class="mb-2">Welcome</h3>
                    <p class="text-muted mb-3">Please log in to access surveys</p>
                    <a class="btn btn-primary" href="/authentication/login">Login</a>
                </div>
            </div>
        </NotAuthorized>
    </AuthorizeView>
}

<style>
    .hover-card { transition: transform .2s ease, box-shadow .2s ease; }
    .hover-card:hover { transform: translateY(-6px); box-shadow: 0 10px 20px rgba(0,0,0,.12) !important; }
</style>
